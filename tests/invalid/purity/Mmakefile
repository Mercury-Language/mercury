#-----------------------------------------------------------------------------#

main_target: check

include ../../Mmake.common

#-----------------------------------------------------------------------------#

SOURCES= \
	impure_func_t2.m \
	impure_func_t3.m \
	impure_func_t4.m \
	impure_func_t5.m \
	impure_func_t7.m \
	impure_pred_t1.m \
	impure_pred_t2.m \
	purity.m \
	purity_nonsense.m

DEPS=		$(SOURCES:%.m=%.dep)
DEPENDS=	$(SOURCES:%.m=%.depend)
ERRS=		$(SOURCES:%.m=%.err)
ERR_RESS=	$(SOURCES:%.m=%.err_res)

%.err: %.m
	if $(MC) $(ALL_MCFLAGS) --errorcheck-only $* > $*.err 2>&1; \
	then false; else true; fi

# Some tests have more than one possible valid output, so
# we allow the test to pass if it matches *either* the .err_exp
# or the .err_exp2 file. 
%.err_res: %.err %.err_exp
	-rm -f $@
	diff -c $*.err_exp $*.err > $@ || \
		{ [ -f $*.err_exp2 ] && diff -c $*.err_exp2 $*.err > $@; }

all:	check

check:	$(ERRS) $(ERR_RESS)

errs:	$(ERRS)

clean_local:
	rm -f *.err *.err_res

#-----------------------------------------------------------------------------#
